# 🔑 Stripe APIキー設定手順

## 🚨 重要：この設定が完了しないと決済機能は動作しません

現在「決済処理でエラーが発生しました」と表示される場合は、Stripe APIキーが設定されていません。

## 📝 設定手順

### 1. .env.localファイルの作成

プロジェクトのルートディレクトリ（package.jsonと同じ場所）に `.env.local` ファイルを作成してください。

**重要**: ファイル名は正確に `.env.local` である必要があります（先頭にドットがあります）。

### 2. 以下の内容をコピーして貼り付け

```bash
# Stripe環境変数設定
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_ここにあなたの公開キーを貼り付け
STRIPE_SECRET_KEY=sk_test_ここにあなたのシークレットキーを貼り付け
NEXT_PUBLIC_STRIPE_SUCCESS_URL=http://localhost:3000/success
NEXT_PUBLIC_STRIPE_CANCEL_URL=http://localhost:3000/cancel
NEXT_PUBLIC_API_URL=http://localhost:3000
```

### 3. APIキーの取得方法

#### Stripeダッシュボードでの設定手順：

1. **Stripeダッシュボードにログイン**
   - https://dashboard.stripe.com/ にアクセス
   - まだアカウントがない場合は無料で作成できます

2. **開発者セクションに移動**
   - 左サイドバーから「開発者」→「APIキー」をクリック

3. **テストキーをコピー**
   - **公開可能キー**（`pk_test_` で始まる）をコピー
   - **シークレットキー**（`sk_test_` で始まる）をコピー
   
   **注意**: 本番キー（`pk_live_`や`sk_live_`）は使用しないでください

4. **`.env.local`ファイルに貼り付け**
   ```bash
   NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_51ABC123de... ← ここに公開キー
   STRIPE_SECRET_KEY=sk_test_51DEF456gh... ← ここにシークレットキー
   ```

### 4. 設定完了後の確認

1. **開発サーバーを再起動**
   ```bash
   # サーバーを停止（Ctrl+C または Cmd+C）してから再起動
   npm run dev
   ```

2. **動作確認**
   - http://localhost:3000/shop にアクセス
   - 商品をカートに追加
   - 決済ボタンをクリック
   - エラーメッセージが消えて、Stripeの決済ページにリダイレクトされることを確認

## 🔍 トラブルシューティング

### 「APIキーが設定されていません」が表示される場合：

1. **ファイル名を確認**
   - `.env.local` （先頭にドット）
   - `env.local` ❌ → `.env.local` ✅

2. **ファイルの場所を確認**
   - `package.json` と同じディレクトリに配置

3. **キーの形式を確認**
   - 公開キー：`pk_test_` で始まる
   - シークレットキー：`sk_test_` で始まる

4. **サーバー再起動**
   - 環境変数の変更後は必ずサーバーを再起動

### 「チェックアウトセッションの作成に失敗しました」が表示される場合：

1. **APIキーの権限確認**
   - Stripeダッシュボードでキーが有効か確認

2. **ネットワーク接続確認**
   - インターネット接続を確認

3. **ブラウザの開発者コンソール確認**
   - F12を押して「Console」タブで詳細エラーを確認

## 💡 ヒント

- **安全性**: `.env.local` ファイルはGitにコミットされません（自動的に除外されます）
- **テスト環境**: 現在はテストモードのため、実際の決済は発生しません
- **カード情報**: テスト用カード番号（4242 4242 4242 4242）が使用できます

## 📞 サポート

設定でお困りの場合は、エラーメッセージと設定内容をお知らせください 